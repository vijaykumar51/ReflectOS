<!DOCTYPE html>
<html>
	<head>
		<title>Web Components</title>

		<link href="css/styles.css" rel="stylesheet" />
		<link
			href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,600i,700,800"
			rel="stylesheet"
		/>
	</head>
	<body>
		<div id="componentTemplates">[[@componentScriptUrls]]</div>
		<div class="topContainer">
			<div class="tabContainer">
				<div class="tabOptionContainer">
					<div class="tabOptions">
						<div class="option home">Home</div>
						<div class="option entertainment">Entertainment</div>
						<div class="option information">Information</div>
						<div class="option sensor">Sensors</div>
					</div>
				</div>
			</div>
			<div id="homeScreenContainer" class="homeScreenContainer"></div>
		</div>

		<script>
			fetch("/api/config")
				.then(data => data.json())
				.then(data => {
					console.log(data);
					let homeScreen = document.getElementById(
						"homeScreenContainer"
					);
					var weatherComponent = document.createElement(
						"weather-component"
					);

					weatherComponent.setAttribute("id", "weatherComponent");
					Object.keys(data.widgets.weather.widgetConfig).forEach(
						configKey => {
							weatherComponent.setAttribute(
								configKey,
								data.widgets.weather.widgetConfig[configKey]
							);
						}
					);
					console.log(weatherComponent);
					homeScreen.innerHTML = `
						${weatherComponent.outerHTML}
						<time-component></time-component>
					`;
				});
		</script>

		<script>
			const { ipcRenderer } = require("electron");
			// Synchronous message emmiter and handler
			console.log(
				ipcRenderer.sendSync("synchronous-message", "sync ping")
			);

			setTimeout(() => {
				ipcRenderer.on("asynchronous-reply", (event, arg) => {
					console.log(arg);
				});
			}, 7000);
			// Async message handler

			// Async message sender
			ipcRenderer.send("asynchronous-message", "async ping");
		</script>
	</body>
</html>
